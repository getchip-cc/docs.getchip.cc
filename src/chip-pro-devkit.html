---
layout: base
permalink: /chip-pro-devkit.html
title: Next Thing Co. C.H.I.P. Pro Developer's Kit Documentation
---

<h1 id="welcome">Welcome!</h1>

<p>This documentation is a resource aimed to get you started with the C.H.I.P. Pro Developer’s Kit. There are lists of contents, descriptions of parts, explanations of how to use the unique features of the board, and some examples to work through so you can get up and running developing your product around C.H.I.P. Pro. Have a C.H.I.P. Pro board but no Dev Kit? Check out the <a href="/chip-pro">C.H.I.P. Pro documentation site</a> to get started.</p>

<h2 id="get-started-with-the-c-h-i-p-pro-dev-kit">Get Started with the C.H.I.P. Pro Dev Kit!</h2>

<p><img src="/images/hero.jpg" alt="C.H.I.P. Pro"></p>

<p>The C.H.I.P. Pro Developer’s Kit provides a complete electronic sandbox to test, iterate, and prototype products with the C.H.I.P. Pro module. While many developer’s kits assume a high-degree of technical experience, we make this kit approachable, compact, and easy to use.
We believe that great products can come from many backgrounds, so we provide several extras in this kit that help you get making and get comfortable. We even include an extra C.H.I.P. Pro to get you started on your own PCB. If you do know it all, you’ll find this documentation will help your product be the best it can be whether you’re making 1 or 1 million.</p>

<h2 id="what-39-s-in-the-kit">What’s in the Kit</h2>

<p><img src="/images/kitContents.jpg" alt="C.H.I.P. Pro Dev Kit Package Contents"></p>

<p>The C.H.I.P. Pro Dev Kit comes with accessories to get you started on your first prototype:</p>

<ul>
<li>1 Dev board with C.H.I.P. Pro soldered on</li>
<li>1 C.H.I.P. Pro (loose)</li>
<li>4 Male/Female jumper wires</li>
<li>Male 0.1" pin headers</li>
<li>1 Button with cap</li>
<li>1 Mini breadboard</li>
<li>4 Little Rubber Feet (LRF)</li>
<li>1 USB A to Micro-USB B cable</li>
<li>WiFi Antenna: <a href="https://github.com/NextThingCo/CHIP_Pro-Hardware/blob/master/v1.0/Component%20Datasheets/FCCID.io-PCB-Antenna-Spec-2656771.pdf">Wacosun model HCX-P321</a></li>
<li>Onboarding Map</li>
</ul>

<h1 id="flash-with-an-os">Flash With An OS</h1>

<p>Before you start building with the C.H.I.P. Pro Dev Kit the C.H.I.P. Pro needs to be flashed with an operating system. We at NTC have built examples that use two operating systems: Buildroot and Debian that are both based on Linux. </p>

<p><strong>Debian</strong> is a classic amongst embedded Linux board users for rapid prototyping. It offers a full package manager and loads of precompiled software for many different architectures. </p>

<p><strong>Buildroot</strong> is simple and stripped down making it efficient and good for single application use cases. </p>

<p>C.H.I.P. Pro has 512MB of high-reliability SLC NAND storage onboard for holding the core operating system and a limited amount of user and program data. While the storage is faster and more reliable it has less capacity. Because of this, it’s a good idea to know how much storage software will take before flashing and installing. Where needed, additional high-speed storage can be added through C.H.I.P. Pro’s SDIO bus.</p>

<p>Ready to try out some examples? Grab these items, then read on!</p>

<ul>
<li>C.H.I.P. Pro Dev Kit</li>
<li>USB A to Micro-USB B cable</li>
<li>Separate computer with <a href="https://www.google.com/chrome/browser/desktop/index.html">Chrome</a> or <a href="https://www.chromium.org/getting-involved/download-chromium">Chromium</a> browser </li>
</ul>

<h2 id="flashing-process">Flashing Process</h2>

<p>Head over to the web flasher at <a href="http://flash.getchip.com/pro">flash.getchip.com/pro</a>. If it’s your first time flashing, when you arrive you will be asked to install the NTC Flasher Chrome Extension.</p>

<p>After installing the extension the main page will give you the option to either download an image or follow the wizard to flash C.H.I.P. Pro. For a smooth automated process, click <strong>FLASH</strong> to flash C.H.I.P. Pro.</p>

<p><img src="/images/main.png" alt="flasher home page"></p>

<p>You will be sent to the <strong>“Flasher First Time Setup”</strong> page which will have instructions dependent on the operating system of your computer. Follow along in the browser or below.</p>

<ul>
<li><p>Linux-specific</p>

<ul>
<li>A Debian-based Linux computer requires creating a set of udev rules to communicate with your C.H.I.P. Pro. Paste the following into a terminal window. </li>
</ul>
<pre class="highlight shell"><code>sudo usermod -a -G dialout <span class="k">${</span><span class="nv">USER</span><span class="k">}</span>
sudo usermod -a -G plugdev <span class="k">${</span><span class="nv">USER</span><span class="k">}</span>

<span class="c"># Create udev rules</span>
<span class="nb">echo</span> -e <span class="s1">'SUBSYSTEM=="usb", ATTRS{idVendor}=="1f3a", ATTRS{idProduct}=="efe8",       GROUP="plugdev", MODE="0660" SYMLINK+="usb-chip"
SUBSYSTEM=="usb", ATTRS{idVendor}=="18d1", ATTRS{idProduct}=="1010", GROUP="plugdev",   MODE="0660" SYMLINK+="usb-chip-fastboot"
SUBSYSTEM=="usb", ATTRS{idVendor}=="1f3a", ATTRS{idProduct}=="1010", GROUP="plugdev",   MODE="0660" SYMLINK+="usb-chip-fastboot"
SUBSYSTEM=="usb", ATTRS{idVendor}=="067b", ATTRS{idProduct}=="2303", GROUP="plugdev",   MODE="0660" SYMLINK+="usb-serial-adapter"
'</span> | sudo tee /etc/udev/rules.d/99-allwinner.rules

sudo udevadm control --reload-rules
</code></pre>
<p>Then logout and log back in.</p>

<p>For the curious:
- ${USER}: outputs your username
- dialout: gives non-root access to serial connections
- plugdev: allows non-root mounting with pmount</p>

<p>The udev rules then map the usb device to the groups. For more information, check <a href="https://wiki.debian.org/SystemGroups">the systems group page on    debian.org</a>.</p></li>
<li><p>Windows-specific</p>

<ul>
<li>To communicate to C.H.I.P. Pro from a Windows computer you must install <a href="https://s3-us-west-2.amazonaws.com/getchip.com/extension/drivers/windows/InstallDriver2.exe">drivers</a>.</li>
<li>Reboot after installing drivers on previous versions (&lt;10) of Windows. </li>
<li>During the fastboot process <strong>Windows may issue the warning “device not recognized”</strong>. Getting this warning during fastboot is <strong>normal</strong> and <strong>flashing should proceed</strong>.</li>
</ul></li>
<li><p>MacOS specific</p>

<ul>
<li>Using USB3 ports can cause the flashing to fail. If you can, try using a USB2 port, not a USB3. If you find yourself with a modern Mac that only has USB3 ports, try using a USB2 hub in your USB3 port and plug C.H.I.P. Pro into that.</li>
<li>OS X El Capitan has been known to have issue with the flashing process. If a new cable or USB2 hub does not work and you are able to, upgrade to macOS Sierra.</li>
</ul></li>
</ul>

<p>When done with setup, press <strong>START!</strong>.</p>

<p><img src="/images/firstsetup.png" alt="first time setup"></p>

<p>Once the extension is installed, plug the micro USB cable into the USB0 port on the Dev Kit (<strong>not on the C.H.I.P. Pro!</strong>). </p>

<p>Hold down the FEL button (a pencil eraser works nicely) and with the other hand plug the USB cable into the computer. When the pink power and white status LEDs on C.H.I.P. Pro light up, you can release the FEL button.</p>

<p><img src="/images/pressPlug.jpg" alt="pushing FELL button"></p>

<p>The web flasher will search for and recognize C.H.I.P. Pro.</p>

<p><img src="/images/searchFlash.png" alt="searching page"> </p>

<p>You will then be directed to the page with the example images. Hover over each image to see a description and click to see more details such as file size and kernel version. When you have chosen your adventure, click <strong>FLASH TO C.H.I.P. PRO</strong>.</p>

<table><thead>
<tr>
<th style="text-align: center"><a href="images/imagesPage.jpg"><img src="/images/imagesPage.png" alt="image page"></a></th>
<th style="text-align: center"><a href="images/imageDetail.png"><img src="/images/imageDetail.png" alt="flash to board"></a></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">Choose image</td>
<td style="text-align: center">Click FLASH TO CHIP PRO</td>
</tr>
</tbody></table>

<p>Watch the flashing process progress and leave the browser tab open in order for it to complete. You will be notified when C.H.I.P. Pro has been flashed successfully. You are then free to unplug the C.H.I.P. Pro or connect to it via <a href="/chip-pro#usb-serial-uart1-connection">serial</a>. </p>

<p><img src="/images/flashFinish.png" alt="succeeded page"></p>

<p>If you are having problems with the flashing process follow the troubleshooting instructions given by the web flasher or check out the <a href="/chip#web-flasher-os-specific-issues">Web Flasher OS-Specific Issues</a> troubleshooting section. </p>

<h2 id="examples">Examples</h2>

<p>You can select an OS by flashing one of our examples using the web flasher <a href="http://flash.getchip.com/pro">flash.getchip.com/pro</a> in Chrome or Chromium browser. Before you go to the web flasher however, there is a method to flashing the C.H.I.P. Pro to know and get in the habit of. This process is explained below and is also illustrated on the flasher page.</p>

<h4 id="blinkenlights">Blinkenlights</h4>

<p>Controlling LEDs are fundamental to almost any hardware. This simple example provides easy-to-understand code with exciting results! Flash C.H.I.P. Pro with this image and watch the GPIO D0-D7 lights turn on and off in a cascading pattern and the two PWM LEDs pulse from dim to bright. Based on Buildroot.</p>

<h4 id="vu-meter">VU Meter</h4>

<p>This example comes with the <a href="https://github.com/xtacocorex/CHIP_IO">CHIP_IO</a> library and Python, all in a very small package! </p>

<p>Want to make sure your mics are working? Use this handy VU Meter example. Scream loudly, speak softly, tap the mics, and MAKE SOME NOISE, SPORTSFANS! You’ll see the LEDs light proportional to the volume of the noise captured by the two built-in mics. Based on Buildroot.</p>

<h4 id="pro">Pro</h4>

<p>We provide a standard Debian distribution. Once flashed connect to the C.H.I.P. Pro via <a href="#usb-serial-uart1-connection">USB-serial</a> and log in with the default username <code class="prettyprint">chip</code> and password <code class="prettyprint">chip</code>.</p>

<p>If you want to configure and build the rootfs for the Debian image, take a look at our <a href="https://github.com/NextThingCo/chip-os-pro">github repo</a></p>

<h3 id="after-flashing-image">After Flashing Image</h3>

<p><img src="/images/poweroffB.gif" alt="power off button"></p>

<p>When you are done or want to flash another example, hold down the power button on the Dev Kit until the Power and Activity LEDs shut off.</p>

<h3 id="troubleshooting-flashing-fails">Troubleshooting Flashing Fails</h3>

<p>If the flashing process fails we have <a href="/chip#web-flasher-os-specific-issues">troubleshooting recommendations</a> based on your OS. </p>

<h1 id="connect-and-control">Connect and Control</h1>

<p>C.H.I.P. Pro is a headless computer, so you will need a separate computer in order to interact with it. This section will go over how to connect to C.H.I.P. Pro Dev Kit through USB-serial, connect to a WiFI network and where to find example scripts on Buildroot.</p>

<h2 id="usb-serial-uart1-connection">USB-Serial UART1 Connection</h2>

<p>This is the first thing you want to do in order to get your board online and give you access to C.H.I.P. Pro’s software. The Dev Kit has a built-in USB to Serial converter for a direct connection to UART1. </p>

<p><img src="/images/usb0.jpg" alt="image page"></p>

<p>To get started, connect the Dev Kit’s USB0 port (<strong>not on the C.H.I.P. Pro!</strong>) to your computer with a common USB A to Micro-USB B cable. Next, you will need terminal emulation software on the computer C.H.I.P. Pro Dev Kit is connected to. Find the OS you are using below to see what software is needed and how to connect.</p>

<h3 id="os-x-amp-linux">OS X &amp; Linux</h3>

<p>Mac systems and most flavors of Linux come with the terminal emulator software Screen. If your Linux distro does not come with Screen and uses Apt install using apt-get:</p>
<pre class="highlight plaintext"><code>sudo apt-get install screen
</code></pre>
<p>With the Dev Kit connected to your computer, open a terminal window. Find out the tty.usbserial dev path the Dev Kit is attached to: </p>

<p><strong>Mac</strong></p>
<pre class="highlight plaintext"><code>ls /dev/tty.*
</code></pre>
<p>It will look something like <code class="prettyprint">usbserial-DN02ACBB</code>. </p>

<p><strong>Linux</strong> </p>
<pre class="highlight plaintext"><code>ls /dev/ttyUSB*
</code></pre>
<p>The port name is usually <code class="prettyprint">ttyUSB0</code>.</p>

<h4 id="connect">Connect</h4>

<p>Use Screen to create a serial terminal connection at 115200 bps:</p>

<p><strong>Mac</strong></p>
<pre class="highlight plaintext"><code>screen /dev/tty.usbserialxxxxxxxx 115200
</code></pre>
<p><strong>Linux</strong></p>
<pre class="highlight plaintext"><code>screen /dev/ttyUSB0 115200
</code></pre>
<p>Once a terminal window pops up, hit the Enter key twice. </p>

<ul>
<li>For a Buildroot example you will automatically be logged in as <code class="prettyprint">root</code>. </li>
<li>For the Debian example, log in with the default username and password <code class="prettyprint">chip</code>.</li>
</ul>

<h4 id="exit-screen">Exit Screen</h4>

<p>When done with Screen, press Ctrl+A then Ctrl+k to kill all windows and terminate Screen. </p>

<p>If you get the error <strong>“Cannot open line&hellip; Resource busy”</strong> when trying to connect via Screen it’s because the last session was not properly exited. Here is how to back and exit properly.</p>

<p>Search for the open file and active process using usbserial:</p>
<pre class="highlight plaintext"><code>lsof | grep usbserial
</code></pre>
<p>You will get an output that looks something like this:</p>
<pre class="highlight plaintext"><code>screen  27127 Sefi  5u  CHR             18,0        0t0     605 /dev/tty.usbserial
</code></pre>
<p>Note the process ID. In this case, it’s 27127. Then run:</p>
<pre class="highlight plaintext"><code>screen -x 27127
</code></pre>
<p>This will return you to the previous screen session. Then use Ctrl+A Ctrl+K to close it (will ask you to confirm).</p>

<h3 id="windows">Windows</h3>

<p>Download the <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">PuTTY terminal emulator</a>.</p>

<p>In Windows, open the <strong>Device Manager</strong>. Find and expand <strong>Ports (COM &amp; LPT)</strong>. Find the port labeled <strong>USB Serial Port (COMx)</strong> and take note of the COMx port number. This is the port that the C.H.I.P. Pro Dev Kit is connected to.</p>

<p>In PuTTY choose <strong>Serial</strong> as the <strong>Connection type</strong>. Plug the following items in and click <strong>Open</strong>. </p>

<ul>
<li>COMx number as the <strong>Serial Line</strong><br></li>
<li>115200 as the <strong>Speed</strong> (baud rate)</li>
</ul>

<table><thead>
<tr>
<th style="text-align: center"><a href="images/ComPort.PNG"><img src="/images/ComPort.PNG" alt="Com Port"></a></th>
<th style="text-align: center"><a href="images/puTTYsetM.jpg"><img src="/images/puTTYsetM.jpg" alt="puTTY"></a></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">In Device Manager find COM port #</td>
<td style="text-align: center">Plug port # and baud rate into puTTY</td>
</tr>
</tbody></table>

<p>Once a terminal window pops up, press Enter. </p>

<ul>
<li>For a Buildroot example you will automatically be logged in as <code class="prettyprint">root</code>. </li>
<li>For the Debian example, log in with the default username and password <code class="prettyprint">chip</code>.</li>
</ul>

<h2 id="edit-buildroot-examples">Edit Buildroot Examples</h2>

<p>After connecting to the Dev Kit via <a href="/chip_pro_devkit#usb-serial-uart1-connection">USB-serial</a> you can check out and edit the scripts for each Buildroot example. Use the Vi command-line editor to read and edit example scripts found in <code class="prettyprint">/usr/bin</code>. </p>

<p><strong>Blinkenlights</strong></p>
<pre class="highlight plaintext"><code>vi /usr/bin/blink-leds
vi /usr/bin/fade-pwms
</code></pre>
<p><strong>VU-Meter</strong></p>
<pre class="highlight plaintext"><code>vi /usr/bin/vu-meter
</code></pre>
<h3 id="basic-vi-editor-commands">Basic Vi Editor Commands</h3>

<p>To <strong>edit text</strong> take Vi from command mode (default) to insert mode. Press the following keys to edit text.</p>

<ul>
<li>i - go into insert mode (to edit text)</li>
<li>Esc - exit insert mode</li>
</ul>

<p>Vi was built for Qwerty keyboards without arrow keys. They may work but if not, use these keys to <strong>move cursor</strong>:</p>

<ul>
<li>J - move down one line</li>
<li>K - move up one line</li>
<li>H - move left one character</li>
<li>L - move right one character</li>
</ul>

<p>Other helpful commands:</p>

<ul>
<li>u - undo last action</li>
<li>:x then Enter - save and exit</li>
<li>:q! then Enter - exit without saving</li>
</ul>

<h2 id="wifi-antenna">WiFi Antenna</h2>

<ul>
<li><p>Onboard WiFi and BT ceramic antenna: <a href="https://github.com/NextThingCo/CHIP_Pro-Hardware/blob/master/v1.0/Component%20Datasheets/WiFi%20BT%20Chip%20321605%20AA055(2400-2500%2080x40)_spec-F.pdf">Unictron product no. H2U34WGTQW0100, model AA055</a>.</p></li>
<li><p>External antenna included in the C.H.I.P. Pro Dev Kit: <a href="https://github.com/NextThingCo/CHIP_Pro-Hardware/blob/master/v1.0/Component%20Datasheets/FCCID.io-PCB-Antenna-Spec-2656771.pdf">Wacosun model HCX-P321</a>.</p></li>
</ul>

<p>C.H.I.P. Pro has an onboard ceramic antenna that is intended for debugging purposes only. We recommend the use of an external antenna for all product applications. Use the antenna that comes with the C.H.I.P. Pro Dev Kit or obtain any of these officially supported ones:</p>

<table><thead>
<tr>
<th>Antenna Model</th>
<th>Manufacturer</th>
<th>Gain</th>
<th>Antenna Type</th>
<th>Connection Type</th>
<th>Freq. Range (GHz)</th>
<th>Cable Length (mm)</th>
</tr>
</thead><tbody>
<tr>
<td>AA107</td>
<td>Unictron</td>
<td>3.3 dBi</td>
<td>PCB</td>
<td>IPEX</td>
<td>2.4 - 2.5</td>
<td>100</td>
</tr>
<tr>
<td>HCX-P321</td>
<td>Wacosun</td>
<td>2 dBi</td>
<td>PCB</td>
<td>IPEX</td>
<td>2.4 - 2.5</td>
<td>150</td>
</tr>
<tr>
<td>FXP73.07.0100A</td>
<td>Taoglas</td>
<td>2.5 dBi</td>
<td>PCB</td>
<td>IPEX</td>
<td>2.4 - 2.483</td>
<td>100</td>
</tr>
<tr>
<td>AA055</td>
<td>Unictron</td>
<td>2.5 dBi</td>
<td>Ceramic</td>
<td>SMT</td>
<td>2.4 - 2.5</td>
<td>n/a</td>
</tr>
</tbody></table>

<h3 id="connect-antenna">Connect Antenna</h3>

<p>C.H.I.P. Pro uses a standard 50Ω IPEX (Hirose U.FL compatible) connector for the external antenna path.</p>

<p>To connect an antenna, come straight from the top and push the antenna onto the connector. Keep in mind the connector will wear out over time. We suggest keeping the disconnect/connect cycle down to 10 or less. </p>

<table><thead>
<tr>
<th style="text-align: center"><a href="images/wifiConnectB.jpg"><img src="/images/wifiConnectB.jpg" alt="wifi antenna connector"></a></th>
<th style="text-align: center"><a href="images/wifiPush.jpg"><img src="/images/wifiPush.jpg" alt="push antenna on"></a></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">WiFi antenna connector</td>
<td style="text-align: center">Push antenna onto connector</td>
</tr>
</tbody></table>

<p><img src="/images/wifiOn.jpg" alt="wifi antenna connected"></p>

<h3 id="enable-wifi-antenna">Enable Wifi Antenna</h3>

<p>In order to use it, you need to set the path of the external antenna.</p>

<p><strong>Buildroot</strong></p>

<p>With the Buildroot C.H.I.P. Pro images comes a <a href="https://raw.githubusercontent.com/NextThingCo/CHIP-buildroot/34a8cfdab2bbecd6741c435d6c400e46848436f1/package/rtl8723ds_mp_driver/set_antenna">set_antenna script</a> which accepts two arguments of either <code class="prettyprint">pcb</code> or <code class="prettyprint">ufl</code> depending on which you want enable. </p>
<pre class="highlight plaintext"><code>sh set_antenna pcb|ufl
</code></pre>
<p><strong>Debian</strong></p>

<p>In Debian, there are two ways to set the antenna path:</p>

<ul>
<li>The RF switch is connected to logic pin PB17. Manually set the logic states to choose either the onboard or external antenna.</li>
</ul>

<p>0 = onboard-antenna </p>

<p>1 = external-antenna</p>

<ul>
<li><code class="prettyprint">wget</code> set_antenna script found <a href="https://raw.githubusercontent.com/NextThingCo/CHIP-buildroot/34a8cfdab2bbecd6741c435d6c400e46848436f1/package/rtl8723ds_mp_driver/set_antenna">here</a>. Run and pass either the <code class="prettyprint">pcb</code> or <code class="prettyprint">ufl</code> argument, as stating above.<br></li>
</ul>

<h2 id="wifi-setup-buildroot">WiFi Setup: Buildroot</h2>

<p>The Buildroot operating system uses the ConnMan command-line network manager to connect and manage your network connections. </p>

<p><strong>Requirements</strong></p>

<ul>
<li>C.H.I.P. Pro running buildroot OS</li>
<li><a href="#usb-serial-uart1-connection">Serial connection</a> to C.H.I.P. Pro</li>
</ul>

<h3 id="step-1-enable-wifi-and-find-a-network">Step 1: Enable WiFi and Find a Network</h3>

<p>These three commands will in turn, enable wifi, scan for access points, and list what networks are available:</p>
<pre class="highlight shell"><code>connmanctl <span class="nb">enable </span>wifi
connmanctl scan wifi
connmanctl services
</code></pre>
<p>The <code class="prettyprint">services</code> command has output similar to:</p>
<pre class="highlight shell"><code>WaffleHouse          wifi_xxxxxxxxxxxx_xxxxxx_managed_psk
                     wifi_xxxxxxxxxxxx_hidden_managed_psk
YOUR_NETWORK         wifi_xxxxxxxxxxxx_xxxxxx_managed_psk
                     wifi_xxxxxxxxxxxx_xxxxxx_managed_none
Donut_Hut            wifi_xxxxxxxxxxxx_xxxxxxxxx_managed_psk
</code></pre>
<h3 id="step-2-connect">Step 2: Connect</h3>

<p>Copy the string that starts with “wifi_’ to the right of the network name you want to connect to. If it has <code class="prettyprint">psk</code> at the end, that means it is password protected (short for Wi-Fi Protected Access 2 - Pre-Shared Key) and you need to scroll further down to the “Password Protected” section.</p>

<h4 id="no-password">No Password</h4>

<p>For example, to connect to NTC Guest, which has no password, <code class="prettyprint">services</code> shows two choices. We want the one without <code class="prettyprint">psk</code> in the string. Use the <code class="prettyprint">connect</code> command:</p>
<pre class="highlight shell"><code>connmanctl connect wifi_xxxxxxxxxxxx_xxxxxx_managed_none
</code></pre>
<p>If your network is not password protected, you’ll get some output that will indicate a successful connection, such as:</p>
<pre class="highlight shell"><code><span class="o">[</span>  961.780000] RTL871X: rtw_set_802_11_connect<span class="o">(</span>wlan0<span class="o">)</span>  <span class="nv">fw_state</span><span class="o">=</span>0x00000008
<span class="o">[</span>  962.070000] RTL871X: start auth
<span class="o">[</span>  962.080000] RTL871X: auth success, start assoc
<span class="o">[</span>  962.090000] RTL871X: rtw_cfg80211_indicate_connect<span class="o">(</span>wlan0<span class="o">)</span> BSS not found !!
<span class="o">[</span>  962.100000] RTL871X: assoc success
<span class="o">[</span>  962.110000] RTL871X: send eapol packet
<span class="o">[</span>  962.290000] RTL871X: send eapol packet
<span class="o">[</span>  962.300000] RTL871X: <span class="nb">set </span>pairwise key camid:4, addr:xx:xx:xx:xx:xx:xx, kid:0, <span class="nb">type</span>:AES
<span class="o">[</span>  962.320000] RTL871X: <span class="nb">set </span>group key camid:5, addr:xx:xx:xx:xx:xx:xx, kid:1, <span class="nb">type</span>:AES
</code></pre>
<p>If your network is password protected you’ll get an error.</p>

<h4 id="password-protected">Password-Protected</h4>

<p>To deal with passwords you’ll need to put ConnMan into interactive mode:</p>
<pre class="highlight shell"><code>connmanctl
</code></pre>
<p>This command gives a <code class="prettyprint">connmanctl</code> prompt:</p>
<pre class="highlight shell"><code>connmanctl&gt;
</code></pre>
<p>In the shell, turn the agent on so it can process password requests:</p>
<pre class="highlight shell"><code>  agent on
</code></pre>
<p>Now use the <code class="prettyprint">connect</code> command with your pasted wifi network string:</p>
<pre class="highlight shell"><code>  connect wifi_xxxxxxxxxxxx_xxxxxx_managed_psk
</code></pre>
<p>Enter your password when prompted:</p>
<pre class="highlight shell"><code>  Agent RequestInput wifi_xxxxxxxxxxxx_xxxxxx_managed_psk
  Passphrase <span class="o">=</span> <span class="o">[</span> <span class="nv">Type</span><span class="o">=</span>psk, <span class="nv">Requirement</span><span class="o">=</span>mandatory <span class="o">]</span>
  Passphrase?
</code></pre>
<p>You will be notified that you are connected:</p>
<pre class="highlight shell"><code>  Connected wifi_xxxxxxxxxxxx_xxxxxx_managed_psk
</code></pre>
<p>Exit connmanctl interactive mode:</p>
<pre class="highlight shell"><code>  quit
</code></pre>
<h3 id="step-3-test-connection">Step 3: Test Connection</h3>

<p>Finally, you can test your connection to the internet with <code class="prettyprint">ping</code>. Google’s DNS server at the IP address 8.8.8.8 is probably the most reliable computer on the internet, so:</p>
<pre class="highlight shell"><code>ping -c 4 8.8.8.8
</code></pre>
<p>Expect ping to output some timing messages:</p>
<pre class="highlight shell"><code>PING 8.8.8.8 <span class="o">(</span>8.8.8.8<span class="o">)</span>: 56 data bytes
64 bytes from 8.8.8.8: <span class="nv">seq</span><span class="o">=</span>0 <span class="nv">ttl</span><span class="o">=</span>60 <span class="nb">time</span><span class="o">=</span>7.631 ms
64 bytes from 8.8.8.8: <span class="nv">seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>60 <span class="nb">time</span><span class="o">=</span>7.474 ms
64 bytes from 8.8.8.8: <span class="nv">seq</span><span class="o">=</span>2 <span class="nv">ttl</span><span class="o">=</span>60 <span class="nb">time</span><span class="o">=</span>7.697 ms
64 bytes from 8.8.8.8: <span class="nv">seq</span><span class="o">=</span>3 <span class="nv">ttl</span><span class="o">=</span>60 <span class="nb">time</span><span class="o">=</span>9.004 ms

--- 8.8.8.8 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max <span class="o">=</span> 7.474/7.951/9.004 ms
</code></pre>
<p>The <code class="prettyprint">-c 4</code> option means it will happen only 4 times.</p>

<p>&#10024; <strong>Congratulations! You are now Connected to a Network</strong> &#10024;</p>

<p>If your connection is not successful, then ping will tell you your network is down:</p>
<pre class="highlight shell"><code>PING 8.8.8.8 <span class="o">(</span>8.8.8.8<span class="o">)</span>: 56 data bytes
ping: sendto: Network is unreachable
</code></pre>
<h4 id="troubleshooting-connection-problems">Troubleshooting Connection Problems</h4>

<ul>
<li><p>Review any messages that the connect command gave you. Did they look like the examples of a successful connection?</p></li>
<li><p>Double check that you used the right network with the <code class="prettyprint">connect</code> command.</p></li>
<li><p>If everything checked out until you got to <code class="prettyprint">ping</code>, there’s a good chance the problem is with your router or connection to the internet. Some networks have firewalls on them that will allow you to connect but prevent foreign devices from transferring information. </p></li>
<li><p>Connman not Installed Error</p>

<p>If you try to use ConnMan and you get an error that it is not found or is not a     command, chances are that you are using the Debian image. The ConnMan commands only apply to C.H.I.P. Pros running the Buildroot OS.</p></li>
</ul>

<h3 id="disconnect-from-network-with-connman">Disconnect from Network with Connman</h3>

<p>To disconnect from your network, you might first want a reminder of the unfriendly string used to describe your access point:</p>
<pre class="highlight shell"><code>connmanctl services
</code></pre>
<p>This command will output information about your current connection:</p>
<pre class="highlight shell"><code>YOUR_NETWORK         wifi_xxxxxxxxxxxx_xxxxxx_managed_psk
</code></pre>
<p>Copy and paste the string ID along with the <code class="prettyprint">disconnect</code> command:</p>
<pre class="highlight shell"><code>connmanctl disconnect wifi_xxxxxxxxxxxx_xxxxxx_managed_psk
</code></pre>
<p>You will be notified when it has disconnected: </p>
<pre class="highlight shell"><code>Disconnected wifi_xxxxxxxxxxxx_xxxxxx_managed_psk
</code></pre>
<h3 id="forget-network-with-connman">Forget Network with Connman</h3>

<p>Generally, ConnMan will remember and cache setup information. This means that if you reboot in the vicinity of a known network, it will attempt to connect. However, if you need to forget a network setup, navigate to:</p>
<pre class="highlight shell"><code><span class="nb">cd</span> /var/lib/connman/
</code></pre>
<p>You can delete a single connection by seeing which are stored and copying the one you want to delete:</p>
<pre class="highlight shell"><code>/var/lib/connman <span class="c"># ls</span>
settings
wifi_xxxxxxxxxxxx_xxxxxx_managed_psk
wifi_xxxxxxxxxxxx_xxxxxx_managed_none
</code></pre>
<p>Then delete that connection:</p>
<pre class="highlight shell"><code>rm -r wifi_xxxxxxxxxxxx_xxxxxx_managed_psk
</code></pre>
<p>You can delete all the “wifi” connections with:</p>
<pre class="highlight shell"><code>rm -r wifi<span class="k">*</span>
</code></pre>
<p>The <code class="prettyprint">-r</code> is needed because these are directories you are deleting and the star at the end of <code class="prettyprint">wifi*</code> assumes your connection IDs all start with the string “wifi”.</p>

<h2 id="wifi-setup-debian">WiFi Setup: Debian</h2>

<p>If you are using the Debian OS you will find that ConnMan is not installed, you will need to use Networking/CLI or the command <code class="prettyprint">nmcli</code> instead. </p>

<p><strong>Requirements</strong></p>

<ul>
<li>C.H.I.P. Pro loaded with Debian</li>
<li><a href="/chip-pro#usb-serial-uart1-connection">Serial connection</a> to C.H.I.P. Pro</li>
</ul>

<h3 id="step-1-list-available-wi-fi-networks">Step 1: List available Wi-Fi networks</h3>

<p>In terminal type:</p>
<pre class="highlight shell"><code>nmcli device wifi list
</code></pre>
<p>The output will list available access points:</p>
<pre class="highlight shell"><code><span class="k">*</span>  SSID      MODE   CHAN  RATE       SIGNAL  BARS  SECURITY
<span class="k">*</span>  YOUR_NETWORK    Infra  11    54 Mbit/s  100     ▂▄▆█  --
   CatCafe         Infra  6     54 Mbit/s  30      ▂___  WPA1 WPA2
   2WIRE533        Infra  10    54 Mbit/s  44      ▂▄__  WPA1 WPA2
</code></pre>
<h3 id="step-2-connect">Step 2: Connect</h3>

<p>You can connect to password protected or open access points.</p>

<h4 id="no-password">No Password</h4>

<p>To connect to an open network with no password:</p>
<pre class="highlight shell"><code>sudo nmcli device wifi connect <span class="s2">"YOUR_NETWORK_SSID"</span> ifname wlan0
</code></pre>
<p>These commands will respond with information about the connection. A successful connection looks like:</p>
<pre class="highlight shell"><code>Connection with UUID <span class="s1">'xxxxxxxx-yyyy-zzzz-xxxx-yyyyyyyyyyyy'</span> created and activated on device <span class="s1">'wlan0'</span>
</code></pre>
<h4 id="password-protected">Password Protected</h4>

<p>To connect to a password protected network, use this command inserting your own network name and password:</p>
<pre class="highlight shell"><code>sudo nmcli device wifi connect <span class="s2">"YOUR_NETWORK_SSID"</span> password <span class="s2">"UR_NETWORK_PASSWORD"</span> ifname wlan0
</code></pre>
<p>These commands will respond with information about the connection. A successful connection looks like:</p>
<pre class="highlight shell"><code>Connection with UUID <span class="s1">'xxxxxxxx-yyyy-zzzz-xxxx-yyyyyyyyyyyy'</span> created and activated on device <span class="s1">'wlan0'</span>
</code></pre>
<h4 id="hidden-ssid-and-password-protected">Hidden SSID and Password Protected</h4>

<p>To connect to a hidden and password-protected network:</p>
<pre class="highlight shell"><code>sudo nmcli device wifi connect <span class="s2">"YOUR_NETWORK_SSID"</span> password <span class="s2">"UR_NETWORK_PASSWORD"</span> ifname wlan0 hidden yes
</code></pre>
<h3 id="step-3-test-your-connection">Step 3: Test your Connection</h3>

<p>You can verify and test your wireless network connection.</p>

<h4 id="verify">Verify</h4>
<pre class="highlight shell"><code>nmcli device status
</code></pre>
<p>This outputs a list of the various network devices and their connections. For example, a successful connection would look like this:</p>
<pre class="highlight shell"><code>DEVICE   TYPE      STATE         CONNECTION
wlan0    wifi      connected     YOUR_NETWORK
wlan1    wifi      disconnected  --
ip6tnl0  ip6tnl    unmanaged     --
lo       loopback  unmanaged     --
sit0     sit       unmanaged     --
</code></pre>
<p>Because it is worth knowing that Linux offers many ways of doing things, another command that shows your current active connection is:</p>
<pre class="highlight shell"><code>nmcli connection show --active
</code></pre>
<p>Which outputs:</p>
<pre class="highlight shell"><code>NAME           UUID                                  TYPE             DEVICE
YOUR_NETWORK   xxxxxxxx-yyyy-zzzz-xxxx-yyyyyyyyyyyy  802-11-wireless  wlan0
</code></pre>
<p>After you have connected once, C.H.I.P. Pro will automatically connect to this network next time you reboot (or start NetworkManager services).</p>

<h4 id="test">Test</h4>

<p>Finally, you can test your connection to the internet with <code class="prettyprint">ping</code>. Google’s DNS server at the IP address 8.8.8.8 is probably the most reliable computer on the internet, so:</p>
<pre class="highlight shell"><code>ping -c 4 8.8.8.8
</code></pre>
<p>Expect ping to output some timing messages:</p>
<pre class="highlight shell"><code>PING 8.8.8.8 <span class="o">(</span>8.8.8.8<span class="o">)</span>: 56 data bytes
64 bytes from 8.8.8.8: <span class="nv">seq</span><span class="o">=</span>0 <span class="nv">ttl</span><span class="o">=</span>60 <span class="nb">time</span><span class="o">=</span>7.631 ms
64 bytes from 8.8.8.8: <span class="nv">seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>60 <span class="nb">time</span><span class="o">=</span>7.474 ms
64 bytes from 8.8.8.8: <span class="nv">seq</span><span class="o">=</span>2 <span class="nv">ttl</span><span class="o">=</span>60 <span class="nb">time</span><span class="o">=</span>7.697 ms
64 bytes from 8.8.8.8: <span class="nv">seq</span><span class="o">=</span>3 <span class="nv">ttl</span><span class="o">=</span>60 <span class="nb">time</span><span class="o">=</span>9.004 ms

--- 8.8.8.8 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max <span class="o">=</span> 7.474/7.951/9.004 ms
</code></pre>
<p>The <code class="prettyprint">-c 4</code> option means it will happen only 4 times.</p>

<p>&#10024; <strong>Congratulations! You are now Connected to a Network</strong> &#10024;</p>

<p>If your connection is not successful, then ping will tell you your network is down:</p>
<pre class="highlight shell"><code>PING 8.8.8.8 <span class="o">(</span>8.8.8.8<span class="o">)</span>: 56 data bytes
ping: sendto: Network is unreachable
</code></pre>
<h3 id="disconnect-network-with-nmcli">Disconnect Network with Nmcli</h3>

<p>Disconnect from the wireless device:</p>
<pre class="highlight shell"><code>sudo nmcli dev disconnect wlan0
</code></pre>
<h3 id="forget-network-with-nmcli">Forget Network with Nmcli</h3>

<p>You may want to prevent auto-connection to a network. If so, you want the device to forget the a specific network. First, list the connections:</p>
<pre class="highlight shell"><code>nmcli c
</code></pre>
<p>Which outputs something like:</p>
<pre class="highlight shell"><code>NAME           UUID                                  TYPE             DEVICE
YOUR_NETWORK   xxxxxxxx-yyyy-zzzz-xxxx-yyyyyyyyyyyy  802-11-wireless  wlan0
</code></pre>
<p>Then delete the network specified between quotes to forget it:</p>
<pre class="highlight shell"><code>sudo nmcli connection delete id <span class="s2">"YOUR_NETWORK"</span>
</code></pre>
<h3 id="troubleshooting-connection-problems">Troubleshooting Connection Problems</h3>

<ul>
<li>No Network Found</li>
</ul>

<p>No network within range. If there’s no network, you can’t connect. Go find a network!</p>

<ul>
<li>Incorrect Password</li>
</ul>

<p>If you type in the wrong password, you’ll get some errors like this:</p>
<pre class="highlight shell"><code><span class="o">[</span>32258.690000] RTL871X: rtw_set_802_11_connect<span class="o">(</span>wlan0<span class="o">)</span> <span class="nv">fw_state</span><span class="o">=</span>0x00000008
<span class="o">[</span>32258.800000] RTL871X: start auth
<span class="o">[</span>32263.720000] RTL871X: rtw_set_802_11_connect<span class="o">(</span>wlan0<span class="o">)</span> <span class="nv">fw_state</span><span class="o">=</span>0x00000008
<span class="o">[</span>32263.820000] RTL871X: start auth
<span class="o">[</span>32264.430000] RTL871X: auth success, start assoc
<span class="o">[</span>32269.850000] RTL871X: rtw_set_802_11_connect<span class="o">(</span>wlan0<span class="o">)</span> <span class="nv">fw_state</span><span class="o">=</span>0x00000008
<span class="o">[</span>32269.970000] RTL871X: start auth
Error: Timeout 90 sec expired.
</code></pre>
<p>Try connecting again with the correct password.</p>

<ul>
<li>Failed Ping</li>
</ul>

<p>If you don’t have access to the internet, your ping to an outside IP will fail.
It is possible that you can connect to a wireless network, but have no access to the internet, so you’d see a connection when you request device status, but have a failed ping. This indicates a problem or restriction with the router or the access point.</p>

<p>A failed ping looks something like:</p>
<pre class="highlight shell"><code>From 192.133.2.10 <span class="nv">icmp_seq</span><span class="o">=</span>14 Destination Host Unreachable
From 192.133.2.10 <span class="nv">icmp_seq</span><span class="o">=</span>15 Destination Host Unreachable
From 192.133.2.10 <span class="nv">icmp_seq</span><span class="o">=</span>16 Destination Host Unreachable
18 packets transmitted, 0 received, +9 errors, 100% packet loss, <span class="nb">time </span>17013ms
pipe 4
</code></pre>
<p>Change the router or access point permissions to allow a foreign board to connect to it. Alternatively, a personal mobile hotspot can obtained and used if you are in a work environment that can not change its network security settings.</p>

<ul>
<li>Loss of Wireless Network</li>
</ul>

<p>A sudden, unplanned disconnection will post an error in the terminal window:</p>
<pre class="highlight shell"><code><span class="o">[</span>30863.880000] RTL871X: linked_status_chk<span class="o">(</span>wlan0<span class="o">)</span> disconnect or roaming
</code></pre>
<p>The Network Manager will periodically try to reconnect. If the access point is restored, you’ll get something like this in your terminal window:</p>
<pre class="highlight shell"><code><span class="o">[</span>31798.970000] RTL871X: rtw_set_802_11_connect<span class="o">(</span>wlan0<span class="o">)</span>
<span class="o">[</span>31799.030000] RTL871X: start auth
<span class="o">[</span>31799.040000] RTL871X: auth success, start assoc
<span class="o">[</span>31799.050000] RTL871X: rtw_cfg80211_indicate_connect<span class="o">(</span>wlan0<span class="o">)</span> BSS not found !!
<span class="o">[</span>31799.060000] RTL871X: assoc success
</code></pre>
<ul>
<li>Nmcli not Installed Error </li>
</ul>

<p>If you try to use <code class="prettyprint">nmcli</code> and you get an error that it is not found or is not a command, chances are that you are using a C.H.I.P. Pro Buildroot image. The <code class="prettyprint">nmcli</code> commands only apply to C.H.I.P. Pro using Debian linux. </p>

<h2 id="ssh">SSH</h2>

<p>Once you connect to an network you can ssh into the C.H.I.P. Pro in order to program and control it. Our <strong>Debian example comes with ssh servers</strong>, our <strong>Buildroot examples do not</strong>. If you want to ssh while using Buildroot you will need to do a manual build. </p>

<h3 id="find-ip">Find IP</h3>
<pre class="highlight plaintext"><code>ip addr
</code></pre>
<p>The IP is on <code class="prettyprint">wlan0</code> or sometimes on <code class="prettyprint">wlan1</code>.</p>

<h3 id="connect">Connect</h3>
<pre class="highlight plaintext"><code>ssh root@&lt;CHIPproIP&gt;
</code></pre>
<h2 id="audio">Audio</h2>

<p>The C.H.I.P. Pro Development Kit has several ways to access audio in and out. Stereo audio in and out is handled by a 24-bit DAC built-in to the GR8 processor. There are also digital options that you can use, but require configuration of the Linux kernel and additional hardware to access.</p>

<ul>
<li>Audio output via 3.5mm TRRS jack</li>
<li>Mono input via 3.5mm TRRS jack</li>
<li>Stereo microphones</li>
<li>MIC1 and MIC2 header pins</li>
<li>I2S digital audio</li>
<li>SPIDIF digital audio</li>
</ul>

<h3 id="input">Input</h3>

<p>There are two (2) analog MEMS (micro electro mechanical) microphones on the Dev Kit. These are enabled by default. </p>

<p>If you want to use the MIC1 and MIC2 pins for audio input, you’ll need to <a href="#back-traces">cut a trace</a>.</p>

<p>The “Sleeve” (bottom-most ring) on the TRRS jack can be used as a mono audio input, suitable for microphones commonly built-in to headphones. If you want to used this connector, you’ll need to <a href="#back-traces">cut a trace</a>.</p>

<h3 id="output">Output</h3>

<p>The 3.5mm TRRS jack provides stereo output suitable for headphones or amplification to stereo speakers.</p>

<h2 id="usb-accessories">USB Accessories</h2>

<p>The USB1 port can be used to connect and use popular accessories like storage, MIDI controllers, keyboards, pointing devices, audio hardware, and more. C.H.I.P. Pro does not provide power to the USB1 port on its own, so the Development Kit is a good example of how this works. </p>

<p><strong>USB1 Power</strong></p>

<p>USB1 is provided with 5V from pass-through of the 5V supplied to the USB0+UART micro USB port on the devkit pcb </p>

<p><strong>For high-load devices</strong> attached to USB1, make sure an adequate power supply is provided. For example, when you plug in a keyboard and an optical mouse, they will draw too much current from the C.H.I.P. Pro Dev Kit, not leaving enough for the processor. As a result, C.H.I.P. Pro will immediately shut down. There are a few ways to avoid this.</p>

<ul>
<li>Use a powered USB hub</li>
<li>Use a bluetooth keyboard and mouse. Yes, this is a very specific solution, but a good one when you are only using the USB port for keyboard and mouse. Keeps your desk cleaner too!</li>
<li>Execute the command <code class="prettyprint">sudo axp209 --no-limit</code> in the terminal before you attach your USB peripherals.</li>
<li>Provide power from a supply connecting ground and 4.8V to 6V to the CHG-IN , pin 4.</li>
</ul>

<h2 id="gpio">GPIO</h2>

<p>C.H.I.P. Pro has a total of 27 GPIO pins ready for use:</p>

<ul>
<li>2 PWM

<ul>
<li>pins 9 &amp; 10</li>
</ul></li>
<li>3 input

<ul>
<li>pins 39 - 41</li>
</ul></li>
<li>22 input/output

<ul>
<li>pins 11-16, 21-25, 30-38, 43 &amp; 44</li>
</ul></li>
</ul>

<p>To see all the functions C.H.I.P. Pro pins offer check out the <a href="/chip-pro#gr8-pins-and-multiplexing-on-c-h-i-p-pro">Multiplexing table</a>.</p>

<p><img src="/images/Pro_Pinout.jpg" alt="pin out"></p>

<h3 id="interacting-with-sysfs">Interacting with Sysfs</h3>

<p>The Linux kernel provides a simple <a href="https://www.kernel.org/doc/Documentation/gpio/sysfs.txt">sysfs interface</a> to access GPIO from. Depending on the image flashed to C.H.I.P. Pro, the commands used to interact with the sysfs interface will differ. If using the <strong>Pro</strong> image, you need to act as root and use <code class="prettyprint">sudo sh -c</code> with quotes around the command string. For example:</p>

<p><strong>Pro (Debian)</strong> </p>
<pre class="highlight shell"><code>sudo sh -c <span class="s1">'echo 132 &gt; /sys/class/gpio/export'</span>
</code></pre>
<p><strong>Buildroot</strong>:</p>
<pre class="highlight shell"><code><span class="nb">echo </span>132 &gt; /sys/class/gpio/export
</code></pre>
<p>Follow along with the examples to learn more about sysfs including how to directly read and write to sysfs. All examples in the GPIO documentation are done using one of NTC’s <strong>Buildroot</strong> based images. </p>

<h3 id="gpio-sysfs-numbers">GPIO Sysfs Numbers</h3>

<p>To address a GPIO port via sysfs, you do not use the C.H.I.P. Pro or GR8 pin name. Sysfs sees the pins as another set of numbers. To find out what number to use for each GPIO pin reference the tables below. </p>

<p><strong>Sysfs Pin Numbers</strong></p>

<p>D0 - D7:</p>

<table><thead>
<tr>
<th>C.H.I.P. Pro Pin #</th>
<th>37</th>
<th>36</th>
<th>35</th>
<th>34</th>
<th>33</th>
<th>32</th>
<th>31</th>
<th>30</th>
</tr>
</thead><tbody>
<tr>
<td>sysfs #</td>
<td>132</td>
<td>133</td>
<td>134</td>
<td>135</td>
<td>136</td>
<td>137</td>
<td>138</td>
<td>139</td>
</tr>
</tbody></table>

<p>TWI1, UART2:</p>

<table><thead>
<tr>
<th>C.H.I.P. Pro Pin #</th>
<th>11</th>
<th>12</th>
<th>13</th>
<th>14</th>
<th>15</th>
<th>16</th>
</tr>
</thead><tbody>
<tr>
<td>sysfs #</td>
<td>47</td>
<td>48</td>
<td>98</td>
<td>99</td>
<td>100</td>
<td>101</td>
</tr>
</tbody></table>

<p>I2S:</p>

<table><thead>
<tr>
<th>C.H.I.P. Pro Pin #</th>
<th>21</th>
<th>22</th>
<th>23</th>
<th>24</th>
<th>25</th>
</tr>
</thead><tbody>
<tr>
<td>sysfs #</td>
<td>37</td>
<td>38</td>
<td>39</td>
<td>40</td>
<td>41</td>
</tr>
</tbody></table>

<p>SPI2:</p>

<table><thead>
<tr>
<th>C.H.I.P. Pro Pin #</th>
<th>41</th>
<th>40</th>
<th>39</th>
<th>38</th>
</tr>
</thead><tbody>
<tr>
<td>sysfs #</td>
<td>128</td>
<td>129</td>
<td>130</td>
<td>131</td>
</tr>
</tbody></table>

<p>PWM:</p>

<table><thead>
<tr>
<th>C.H.I.P. Pro Pin #</th>
<th>9</th>
<th>10</th>
</tr>
</thead><tbody>
<tr>
<td>sysfs #</td>
<td>0</td>
<td>1</td>
</tr>
</tbody></table>

<p>UART1:</p>

<p>** These pins are connected to the FE1.1S USB hub controller IC which is connected to the micro USB providing USB serial functionality. To use them as GPIO disable the USB hub controller by cutting the “UART Disconnect” <a href="#cuttable-traces">traces</a>. </p>

<table><thead>
<tr>
<th>C.H.I.P. Pro Pin #</th>
<th>44</th>
<th>43</th>
</tr>
</thead><tbody>
<tr>
<td>sysfs #</td>
<td>195</td>
<td>196</td>
</tr>
</tbody></table>

<p><strong>Calculate sysfs Number</strong></p>

<p>If a pin is not listed above you can calculate the sysfs number starting with the GR8 port number. All port numbers are printed on C.H.I.P. Pro for your convenience. They can also be found in the <a href="https://github.com/NextThingCo/CHIP_Pro-Hardware/blob/master/Datasheets/GR8_Datasheet_v1.0.pdf">Allwinner R8 Datasheet</a> starting on page 15. </p>

<p>As an example, take a look at <strong>D0</strong> which is port <strong>PE4</strong>. Look at the letter that follows the “P”, in this case it’s “E”. Starting with A = 0, count up in the alphabet until you arrive at “E” and that is the letter index. For example, <strong>E=4</strong>.</p>

<p>Multiply the letter index by 32, then add the number that follows “PE”:</p>

<p>(4*32)+4 = 132</p>

<h3 id="export-digital-gpios">Export Digital GPIOs</h3>

<p>The GPIO control interface can be found at <code class="prettyprint">/sys/class/gpio</code>. To explore the sysfs file structure, connect to C.H.I.P. Pro via <a href="#usb-serial-uart1-connection">USB-serial</a> and in a terminal window type: </p>
<pre class="highlight plaintext"><code>ls /sys/class/gpio
</code></pre>
<p>In the <strong>gpio</strong> directory you will find:</p>

<ul>
<li><strong>export</strong> - Allows a GPIO signal to be read and written to. </li>
<li><strong>unexport</strong> - Reverses the effect of exporting. </li>
</ul>

<p>To read and write to a pin it must first be exported. As an example, use the sysfs number <strong>132</strong> to export pin <strong>PE4</strong>:</p>
<pre class="highlight shell"><code><span class="nb">echo </span>132 &gt; /sys/class/gpio/export
</code></pre>
<p>Once exported, a GPIO signal will have a path like <code class="prettyprint">/sys/class/gpio/gpioN</code> where N is the sysfs number. In the <strong>gpioN</strong> directory, you can see what attributes are available to read and write to:</p>
<pre class="highlight shell"><code>ls /sys/class/gpio/export/gpio132
</code></pre>
<ul>
<li><strong>direction</strong> - Set direction of pin using “in” or “out.” All GPIOs are I/Os except for PE0, PE1 and PE2 which are input only.</li>
<li><strong>value</strong> - Value of pin written or read as either 0 (low) or 1 (high).</li>
<li><strong>edge</strong> - Written or read as either “non”, “rising”, “falling”, or “both”. This attribute only shows up when the pin can be configurred as an interrupt.</li>
<li><strong>active_low</strong> - Reads as either 0 (false) or 1 (true). Write any nonzero value to invert the value attribute both for reading and writing.</li>
</ul>

<p>Learn more about the sysfs interface <a href="https://www.kernel.org/doc/Documentation/gpio/sysfs.txt">here</a>.</p>

<h3 id="digital-input-example">Digital Input Example</h3>

<p>The following example goes through a general command sequence to read the changing state of a pin. This example reads a switch connected to <strong>PE4</strong>. When wiring up a switch, add an external pull-up or pull-down resistor to prevent a floating pin logic state. The photo below shows a pull-down resistor.</p>

<p><img src="/images/pullDown.jpg" alt="pull-down resistor"></p>

<p>In terminal, tell the system you want to listen to a pin by exporting it:</p>
<pre class="highlight shell"><code><span class="nb">echo </span>132 &gt; /sys/class/gpio/export
</code></pre>
<p>Next, the pin direction needs to be set. Use <code class="prettyprint">cat</code> to read what direction the pin is currently set to:</p>
<pre class="highlight shell"><code>cat /sys/class/gpio/gpio132/direction
</code></pre>
<p>Switch the pin’s direction to “in”:</p>
<pre class="highlight shell"><code><span class="nb">echo </span><span class="k">in</span> &gt; /sys/class/gpio/gpio132/direction
</code></pre>
<p>Connect a switch between pin PE4 and GND and read the value:</p>
<pre class="highlight shell"><code>cat /sys/class/gpio/gpio132/value
</code></pre>
<p>Continuously check the value of the switch pin for its state change:</p>
<pre class="highlight shell"><code><span class="k">while</span> <span class="o">(</span> <span class="nb">true</span> <span class="o">)</span>; <span class="k">do </span>cat /sys/class/gpio/gpio132/value; sleep 1; <span class="k">done</span>;
</code></pre>
<p>Unexport:</p>
<pre class="highlight shell"><code><span class="nb">echo </span>132 &gt; /sys/class/gpio/unexport
</code></pre>
<h3 id="digital-output-example">Digital Output Example</h3>

<p><strong>Onboard LEDs</strong></p>

<p>The Dev Kit provides ten onboard LEDs to make testing the GPIOs easy without having to wire anything up. Eight of these LEDs are connected to digital I/O pins that can be turned on and off with standard Linux sysfs commands. </p>

<ul>
<li>Pins 30 - 37 which are seen as 132 - 139 in sysfs.</li>
</ul>

<p><strong>Blinkenlights Image</strong></p>

<p>To start with an example that demos the eight I/Os and two PWM onboard LEDs, <a href="#examples">flash C.H.I.P. Pro Dev Kit with the Blinkenlights</a> image and <a href="#edit-buildroot-examples">view the example scripts</a> using the command-line editor Vi. </p>

<p><strong>Turn LED On and Off</strong></p>

<p>Follow along to turn on and off the LED attached to pin 37.</p>

<p><img src="/images/blink.gif" alt="UART connection"></p>

<p>Export the pin and change the mode from “in” to “out”:</p>
<pre class="highlight shell"><code><span class="nb">echo </span>132 &gt; /sys/class/gpio/export
<span class="nb">echo </span>out &gt; /sys/class/gpio/gpio132/direction
</code></pre>
<p>Now that it’s in output mode, you can write a value to the pin and turn the LED on and off:</p>
<pre class="highlight shell"><code><span class="nb">echo </span>1 &gt; /sys/class/gpio/gpio132/value
<span class="nb">echo </span>0 &gt; /sys/class/gpio/gpio132/value
</code></pre>
<p>Unexport: </p>
<pre class="highlight shell"><code><span class="nb">echo </span>132 &gt; /sys/class/gpio/unexport
</code></pre>
<h4 id="blink">Blink</h4>

<p>After exporting a pin run this to blink an LED on pin 37.</p>
<pre class="highlight shell"><code><span class="k">while</span> <span class="o">(</span> <span class="nb">true</span> <span class="o">)</span>; <span class="k">do </span><span class="nb">echo </span>1 &gt; /sys/class/gpio/gpio132/value; cat /sys/class/gpio/gpio132/value; sleep 1; <span class="nb">echo </span>0 &gt;  /sys/class/gpio/gpio132/value; cat /sys/class/gpio/gpio132/value; sleep 1; <span class="k">done</span>;
</code></pre>
<h3 id="unexport-gpio">Unexport GPIO</h3>

<p>If pins have not been unexported an error will occur stating the pins are “busy” the next time you go to export them. When you are done using a GPIO pin <strong>always</strong> tell the system to stop listening by unexporting it:</p>
<pre class="highlight shell"><code><span class="nb">echo </span>132 &gt; /sys/class/gpio/unexport
</code></pre>
<h2 id="pwm">PWM</h2>

<p>C.H.I.P. Pro can output a PWM signal up to 24 MHz on two pins: PWM0 and PWM1. The Dev Kit also features two places to connect servos that provide the power needed to drive them. </p>

<h3 id="pwm-via-sysfs">PWM via sysfs</h3>

<p>Depending on the image that is flashed to C.H.I.P. Pro, the commands used to interact with the sysfs interface will differ. If using a <strong>Pro</strong> image, you need to act as root and use <code class="prettyprint">sudo sh -c</code> with quotes around the command string. For example:</p>

<p><strong>Pro (Debian)</strong></p>
<pre class="highlight shell"><code>sudo sh -c <span class="s1">'echo 0 &gt; export'</span> <span class="c">#PWM0</span>
</code></pre>
<p><strong>Buildroot</strong>:</p>
<pre class="highlight shell"><code><span class="nb">echo </span>0 &gt; <span class="nb">export</span> <span class="c">#PWM0</span>
</code></pre>
<p>All PWM examples are done using one of NTC’s <strong>Buildroot</strong> based images. </p>

<h3 id="export-pwm-channel">Export PWM Channel</h3>

<p>The Linux kernel provides a simple <strong>sysfs</strong> interface to access PWM from. The PWM controller can be found exported as <strong>pwmchip0</strong> at <code class="prettyprint">/sys/class/pwm/pwmchip0</code>. To test the PWM channels and explore the sysfs file structure, connect to C.H.I.P. Pro via <a href="#usb-serial-uart1-connection">USB-serial</a> and in a terminal window type: </p>
<pre class="highlight plaintext"><code>ls /sys/class/pwm/pwmchip0
</code></pre>
<p>In the <strong>pwmchip0</strong> directory you will find:</p>

<ul>
<li><strong>export</strong> - Allows a PWM channel to be read and written to. </li>
<li><strong>unexport</strong> - Reverses the effect of exporting (always do this after you are done using a channel).</li>
<li><strong>npwm</strong> - Says how many PWM channels are available. </li>
</ul>

<p>You can see there are two PWM channels available from C.H.I.P. Pro’s PWM controller/chip by using <code class="prettyprint">cat</code>:</p>
<pre class="highlight plaintext"><code>cd /sys/class/pwm/pwmchip0
cat npwm
</code></pre>
<p>Before you can use a channel you need to export it. Use these numbers to reference which pin you would like to export:</p>

<table><thead>
<tr>
<th>C.H.I.P. Pro Pin #</th>
<th>9</th>
<th>10</th>
</tr>
</thead><tbody>
<tr>
<td>sysfs #</td>
<td>0</td>
<td>1</td>
</tr>
</tbody></table>
<pre class="highlight shell"><code><span class="nb">echo </span>0 &gt; <span class="nb">export</span> <span class="c">#PWM0</span>
ls
</code></pre>
<p>After exporting, you will find that a new directory <strong>pwmX</strong>, where X is the channel number, has been created. Go into the pwmX directory to check out the attributes available for use:</p>
<pre class="highlight shell"><code><span class="nb">cd </span>pwm0
ls
</code></pre>
<p>In the pwmX directory you will find: </p>

<ul>
<li><strong>duty_cycle</strong> - The active time of the PWM signal in nanoseconds. Must be less than the <strong>period</strong>.</li>
<li><p><strong>enable</strong> - Enable/disable the PWM signal using either 0 or 1.</p>

<p>0 - disabled</p>

<p>1 - enabled</p></li>
<li><p><strong>period</strong> - Total period of inactive and active time of the PWM signal in nanoseconds.</p></li>
<li><p><strong>polarity</strong> - Changes the polarity of the PWM signal. Value is “normal” or “inversed”.</p></li>
</ul>

<p>To test the PWM channels follow the examples below.</p>

<h3 id="pwm-led-example">PWM LED Example</h3>

<p>There are two onboard LEDs connected to the PWM pins for testing and learning about pulse width modulation. You can disconnect these PWM LEDs at any time by <a href="#cuttable-traces">cutting traces</a>. </p>

<p><img src="/images/fade.gif" alt="PWM0 LED fade"></p>

<p>Export a channel, set the polarity and enable PWM0:</p>
<pre class="highlight shell"><code><span class="nb">echo </span>0 &gt; /sys/class/pwm/pwmchip0/export
<span class="nb">echo</span> <span class="s2">"normal"</span> &gt; /sys/class/pwm/pwmchip0/pwm0/polarity
<span class="nb">echo </span>1 &gt; /sys/class/pwm/pwmchip0/pwm0/enable
</code></pre>
<p>Set the period to 10000000 nanoseconds (1 second) and the duty cycle to 0:</p>
<pre class="highlight shell"><code><span class="nb">echo </span>10000000 &gt; /sys/class/pwm/pwmchip0/pwm0/period
<span class="nb">echo </span>0 &gt; /sys/class/pwm/pwmchip0/pwm0/duty_cycle
</code></pre>
<p>From here, set the duty_cycle in nanoseconds. Start dim at 1% and step up to the 100%:</p>
<pre class="highlight shell"><code><span class="nb">echo </span>100000 &gt; /sys/class/pwm/pwmchip0/pwm0/duty_cycle
<span class="nb">echo </span>500000 &gt; /sys/class/pwm/pwmchip0/pwm0/duty_cycle
<span class="nb">echo </span>1000000 &gt; /sys/class/pwm/pwmchip0/pwm0/duty_cycle
<span class="nb">echo </span>5000000 &gt; /sys/class/pwm/pwmchip0/pwm0/duty_cycle
<span class="nb">echo </span>10000000 &gt; /sys/class/pwm/pwmchip0/pwm0/duty_cycle
</code></pre>
<p>Disable and unexport:</p>
<pre class="highlight shell"><code><span class="nb">echo </span>0 &gt; /sys/class/pwm/pwmchip0/enable
<span class="nb">echo </span>0 &gt; /sys/class/pwm/pwmchip0/unexport
</code></pre>
<h3 id="pwm-servo-examples">PWM Servo Examples</h3>

<p><img src="/images/mainServo.jpg" alt="servo connected to dev kit"></p>

<p>The C.H.I.P. Pro Dev Kit provides breakout pins to conveniently power and control servos. </p>

<p>Most servos have three pins: <strong>power</strong>, <strong>ground</strong>, and a <strong>control signal</strong>. The control signal is a pulse-width-modulated input signal whose high pulse width (within a determined period) determines the servo’s angular position. The control signal pin draws a small enough amount of current that it can be directly controlled by the PWM pins on C.H.I.P. Pro. </p>

<p><img src="/images/pwmPins.jpg" alt="servo connected to dev kit"></p>

<p>While the control signal pin draws a low amount of power, the servo motor draws more power than the C.H.I.P. Pro can provide on its own. The Dev Kit helps with this by providing a <strong>5 volt power pin</strong> next to the signal and ground pin. This pin is connected to the <strong>DC-In barrel jack</strong>. </p>

<p>The PWM0 and PWM1 through-holes are staggered just enough to friction hold male header pins. No soldering needed! (•◡•)/</p>

<p><strong>Setup PWM Channel</strong></p>

<p>Export the PWM pin you want to use:</p>
<pre class="highlight shell"><code><span class="nb">echo </span>0 &gt; /sys/class/pwm/pwmchip0/pwm0/export
</code></pre>
<p><strong>Enable</strong> the channel and set the <strong>polarity</strong>, <strong>period</strong> of the waveform and <strong>duty cycle</strong>. Units are in <strong>nanoseconds</strong>. The <strong>polarity</strong> can only be set before the pin is enabled. If you set it after enabling a pin the script should still work but you will see a “I/O error”. Most servos operate at <strong>50Hz which translates into a 20000000 ns period</strong>. Start the <strong>duty cycle</strong> at <strong>0</strong>:</p>
<pre class="highlight shell"><code><span class="nb">echo </span>normal &gt; /sys/class/pwm/pwmchip0/pwm0/polarity
<span class="nb">echo </span>1 &gt; /sys/class/pwm/pwmchip0/pwm0/enable
<span class="nb">echo </span>20000000 &gt; /sys/class/pwm/pwmchip0/pwm0/period
<span class="nb">echo </span>0 &gt; /sys/class/pwm/pwmchip0/pwm0/duty_cycle
</code></pre>
<p>Once you do this initial setup, to rotate the servo change the <strong>duty_cycle</strong>. Whatever value is written to the duty_cycle changes the active time of the PWM signal. To get you started, there are two examples below, one rotates a 180º servo, the other rotates and stops a 360º continuous servo.</p>

<h4 id="180-servo">180º Servo</h4>

<p><img src="/images/sweep_180.gif" alt="180º servo sweeping"></p>

<p><strong>Servo Used in Example</strong></p>

<ul>
<li>180º degree 4.8V - 6V <a href="http://hitecrcd.com/products/servos/micro-and-mini-servos/analog-micro-and-mini-servos/hs-40-economical-nano-nylon-gear-servo/product">Hitec HS-40</a></li>
</ul>

<p>Before you start to work with your servo, check the servo’s datasheet. There you can sometimes find the pulse width range needed to control it. </p>

<p>To rotate 180º most servos require a duty cycle where 1000000 ns/1 ms corresponds to the minimum angle and 2000000 ns/2 ms corresponds to the maximum angle. However, not all servos are the same and will require calibration. For example, the HS-40 used in this example has a minimum of 600000 ns/0.6 ms and maximum of 2400000 ns/2.4 ms. A good place to start is somewhere in the middle like 1500000 ns/1.5 ms. You can then go up and down from there to find the max. and min. </p>

<p>Change the duty cycle to 1500000 ns and step up every 100000 ns to move the servo:</p>
<pre class="highlight shell"><code><span class="nb">echo </span>1500000 &gt; /sys/class/pwm/pwmchip0/pwm0/duty_cycle
<span class="nb">echo </span>1600000 &gt; /sys/class/pwm/pwmchip0/pwm0/duty_cycle
<span class="nb">echo </span>1700000 &gt; /sys/class/pwm/pwmchip0/pwm0/duty_cycle
</code></pre>
<p>When done, disable and unexport pin:</p>
<pre class="highlight shell"><code><span class="nb">echo </span>0 &gt; /sys/class/pwm/pwmchip0/pwm0/enable
<span class="nb">echo </span>0 &gt; /sys/class/pwm/pwmchip0/unexport
</code></pre>
<h5 id="sweep-script">Sweep Script</h5>

<p><a href="https://github.com/laraCat/CHIP_Pro_DKit_Examples/blob/master/PWM/sweep.sh">This</a> script rotates a servo on PWM0 from 0º to 180º while printing the duty cycle. Press Ctrl+C to unexport PWM0 and exit the script. You may need to calibrate the minimum and maximum to fit your servo. </p>

<h4 id="360-continuos-servo">360º Continuos Servo</h4>

<p><img src="/images/sweep_360.gif" alt="360º sweeping"></p>

<p><strong>Servo Used in Example</strong></p>

<ul>
<li>360º Continuous 4.8V - 6V <a href="https://cdn-shop.adafruit.com/product-files/2442/FS90R-V2.0_specs.pdf">FEETEC FS90R Micro Servo</a></li>
</ul>

<p>For a continuous servo the PWM input signal controls the speed, direction of rotation and stopping period.  Before you start to work with your servo, check the servo’s datasheet. There you can sometimes find the pulse width range needed to control it. </p>

<p>A typical stop width is <strong>1500000 ns/1.5 ms</strong>. The further the time travels above and below the stop width, the slower the rotation speed gets.</p>

<p>Below are the times for the FS90R servo. Yours may be slightly different. A good place to start is 1500000 ns and going 100000 ns up and down from there to find the stop, right and left pulse times.</p>

<ul>
<li>1500000 ns: stop</li>
<li>1000000 ns - 1400000 ns: slow - fast right</li>
<li>1600000 ns - 2000000 ns: slow - fast left<br></li>
</ul>

<h5 id="sweep-script">Sweep Script</h5>

<p>This <a href="https://github.com/laraCat/CHIP_Pro_DKit_Examples/blob/master/PWM/sweepCont.sh">script</a> steps a servo connected to PWM0 through different speeds while rotating in each direction. Press Ctrl+C to unexport PWM0 and exit script. Each speed lasts for two seconds. It stops for one second at 1500000 ns before rotating in the opposite direction.</p>

<h3 id="unexport-pwm">Unexport PWM</h3>

<p>If pins have not been unexported an error will occur stating the pins are “busy” the next time you go to export them. When you are done using a PWM pin <strong>always</strong> tell the system to stop listening by unexporting it:</p>
<pre class="highlight shell"><code><span class="nb">echo </span>0 &gt; /sys/class/gpio/unexport <span class="c">#PWM0</span>
</code></pre>
<h1 id="power">Power</h1>

<h2 id="powering-off">Powering Off</h2>

<p>After C.H.I.P. Pro has been flashed with a new image you can power off the board by holding the power button on the dev board down (for about 5 seconds). Wait for the power and status LEDs to turn off. </p>

<p><img src="/images/poweroffB.gif" alt="power off button"></p>

<p>If running processes while connected to C.H.I.P. Pro we recommend powering off C.H.I.P. Pro via command line:</p>

<p><strong>Buildroot</strong></p>
<pre class="highlight plaintext"><code>poweroff
</code></pre>
<p><strong>Debian</strong></p>
<pre class="highlight plaintext"><code>sudo poweroff
</code></pre>
<p>In this instance the software puts all processes away properly making it is safe to remove the power supply from the Dev Kit without the risk of losing data. </p>

<h2 id="power-c-h-i-p-pro-dev-kit">Power C.H.I.P. Pro Dev Kit</h2>

<p><img src="/images/powerIn.jpg" alt="image page"></p>

<p>There are three ports on the Dev Kit that support three different power supplies:</p>

<ul>
<li><strong>Micro USB port</strong> - Use either an AC/DC adapter or powered USB hub with a micro USB plug.</li>
<li><strong>JST-PH 2.0mm</strong> - Connect a rechargeable 3.7V lithium polymer battery to the JST port. Press the On/Off button to power C.H.I.P. Pro. Charge a LiPo battery connected to this port by connecting an AC adapter to the barrel jack.</li>
<li><strong>DC-IN barrel jack</strong> - Plug in a 6 - 23V AC/DC adapter (we recommend getting one that supplies 12V and 1 amps). </li>
</ul>

<p>Power can also be provided to <strong>three pins</strong> to power C.H.I.P. Pro:</p>

<ul>
<li><strong>CHG-IN</strong> - connect 4.8 to 6 V of power to pin 4 (and GND) to provide power to C.H.I.P. Pro. If you have a 3.7V Lithium Polymer (LiPo) battery connected to BAT, then power provided to CHGIN will also charge the battery.</li>
<li><strong>BAT</strong> - connect a 3.7V Lithium Polymer (LiPo) battery to pin 8 (and GND) to provide power to C.H.I.P. Pro. You can charge the battery by providing voltage to the CHG-IN pin. When a battery is connected, short the PWRON (PWR) pin to ground for 2 seconds to start current flow. </li>
<li><strong>VBUS</strong> - connect 5V to pin 50 (and GND to pin 53) to provide power to C.H.I.P. Pro.</li>
</ul>

<h2 id="power-out">Power Out</h2>

<p>The C.H.I.P. Pro Dev kit can provide power to sensors and peripherals.</p>

<ul>
<li><strong>VCC-3V3</strong> - pin 2 provides 3.3V for sensors and anything else. This pin can provide a maximum of 800mA. The 800mA supply takes into account system load and can vary depending on what the Wifi module and GR8 SOC are requiring from the AXP209 power management IC.</li>
<li>For your servo needs PWM0 and PWM1 breakout through-holes provide 5V volts and 2.5A.</li>
<li><strong>IPSOUT</strong> - pin 3, this is AXP209’s <strong>I</strong>ntelligent <strong>P</strong>ower <strong>S</strong>elect pin. It automatically supplies current from available sources based on logic set in the registers.</li>
<li><strong>USB1 Host</strong> - provide power to USB peripherals.</li>
<li><strong>PWRON</strong> - connect to ground to turn C.H.I.P. Pro on and boot the operating system.</li>
</ul>

<h2 id="battery-charging-and-bts-pin">Battery Charging and BTS Pin</h2>

<p>The Dev Kit uses the <strong>AXP209 IC</strong> to manage charging. Pin 7 marked <strong>BATTEMP or BTS</strong> is directly connected to the <strong>TS</strong> pin on the AXP209. This pin supports a thermistor to monitor the battery temperature when the battery is charging or discharging.  If you do not incorporate a thermistor into your setup the pin may float from ground interferring with how much charge current is throttled to the <strong>BAT</strong> pin and the <strong>JST connector</strong>. To ensure maximum charge current without a thermistor disable the battery temperature monitoring system.</p>

<p>There are two ways to do this:</p>

<ul>
<li>Connect BTS pin to ground</li>
<li>Disable the temperature functionality in software:</li>
</ul>
<pre class="highlight shell"><code>sudo i2cset -y -f 0 0x34 0x82 0x82
</code></pre>
<p>The AXP209 IC is seen as a I2C device on C.H.I.P. Pro. By default the AXP209 is tuned for a 10KΩ 1% thermistor at 25°C with a programmable register for thermistor current to adapt to different devices. You can find more information on this setup in the <a href="https://github.com/NextThingCo/CHIP-Hardware/blob/master/CHIP%5Bv1_0%5D/CHIPv1_0-BOM-Datasheets/AXP209_Datasheet_v1.0en.pdf">AXP209 Datasheet</a>. Search “ts pin” to quickly find information.</p>

<h2 id="axp209-power-management">AXP209 Power Management</h2>

<p>There are several ways to power the C.H.I.P. Pro Dev Kit and your creative endeavors. The Dev Kit boasts a AXP209 Power System Management IC designed to switch to any available power source. The following table details what happens with some different power scenarios.</p>

<table><thead>
<tr>
<th>Power Source</th>
<th>Result</th>
</tr>
</thead><tbody>
<tr>
<td>Battery</td>
<td>C.H.I.P. Pro is powered by battery, USB1 does not receive 5V</td>
</tr>
<tr>
<td>Battery + DC In</td>
<td>C.H.I.P. Pro is powered by DC In, battery can be charged up to 1.8A</td>
</tr>
<tr>
<td>Battery + USB In</td>
<td>C.H.I.P. Pro is powered by USB in, battery can be charged up to 900mA by default, more if the no-limit setting is used</td>
</tr>
<tr>
<td>Battery + DC In + USB In</td>
<td>C.H.I.P. Pro is powered by DC In, battery is charged</td>
</tr>
<tr>
<td>Battery + low amperage DC or USB In</td>
<td>Battery powers C.H.I.P. Pro as needed to prevent shut down</td>
</tr>
</tbody></table>

<p>Overvoltage can cause permanent damage. Find more details for each port’s specifications in the <a href="https://github.com/NextThingCo/CHIP_Pro-Hardware/blob/master/v0.9/Datasheets/CHIP_PRO_Datasheet_v1.0.pdf">C.H.I.P. Pro datasheet</a> and <a href="https://github.com/NextThingCo/CHIP-Hardware/blob/master/CHIP%5Bv1_0%5D/CHIPv1_0-BOM-Datasheets/AXP209_Datasheet_v1.0en.pdf">AXP209 Datasheet.</a></p>

<h1 id="technical-documents">Technical Documents</h1>

<h2 id="dev-kit-component-datasheets">Dev Kit Component Datasheets</h2>

<p>Find all the datasheets to the components found on C.H.I.P. Pro Dev Kit <a href="https://github.com/NextThingCo/Dev_Kit-Hardware/tree/master/Datasheets">here</a>.</p>

<h2 id="dev-kit-schematics-and-design-files">Dev Kit Schematics and Design Files</h2>

<p>The schematics for C.H.I.P. Pro Dev Kit are available in easy to read <a href="https://github.com/NextThingCo/Dev_Kit-Hardware/tree/master/PDFs">PDFs</a> or <a href="https://github.com/NextThingCo/Dev_Kit-Hardware/tree/master/PCB">Eagle design files</a>. </p>

<h2 id="c-h-i-p-pro-datasheet">C.H.I.P. Pro Datasheet</h2>

<p>The complete datasheet for C.H.I.P. Pro is available <a href="https://github.com/NextThingCo/CHIP_Pro-Hardware/raw/master/Datasheets">in our C.H.I.P. Pro Hardware GitHub repo</a>.</p>

<h2 id="open-source-license">Open Source License</h2>

<p>C.H.I.P. Pro Dev Kit is open source hardware and software. Find all you need to build a C.H.I.P. Pro Dev Kit in our <a href="https://github.com/NextThingCo/Dev_Kit-Hardware">Github repo</a>. The Dev Kit is powered by C.H.I.P. Pro. Find all technical documents for C.H.I.P. Pro in its <a href="https://github.com/NextThingCo/CHIP_Pro-Hardware">own dedicated repository</a>. Search our repositories for core and developing software. For up-to-date announcements on software releases visit our <a href="https://nextthing.co/">website</a> and sign up to our newsletter. Or, join the community on our <a href="https://bbs.nextthing.co/">forum</a> where we actively post announcements.   </p>

<p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p>

<h1 id="what-39-s-on-the-board">What’s on the Board</h1>

<h2 id="c-h-i-p-pro-dev-kit-features">C.H.I.P. Pro Dev Kit Features</h2>

<p><img src="/images/frontCallout.jpg" alt="Front Callouts"></p>

<ul>
<li><strong>USB1 Port (2.0 Host)</strong> - USB A jack lets C.H.I.P. Pro act as a USB EHCI/OHCI host for external devices. By default, this is powered by the USB micro jack. Cut the appropriate trace to power this from the barrel jack instead. </li>
<li><strong>USB0 VBUS Power LED</strong> - When there is power available to the USB1 port, this LED will illumniate.</li>
<li><strong>USB0 + UART1</strong> - The micro USB jack provides serial and USB gadget connectivity, power from a USB power source, and UART connectivity for complete terminal messages from boot time.</li>
<li><strong>3.7 LiPo battery jack</strong> - a JST connector for connecting and powering the dev kit from a 3.7 volt Lithium Polymer battery.</li>
<li><strong>1/8" Audio Jack</strong> - This TRRS jack provides stereo audio out and optional mono input.</li>
<li><strong>DC In Jack</strong> - Connect a power supply ranging from 6V to 23V to power the C.H.I.P. Pro.</li>
<li><strong>CHG-IN On/Off Switch</strong> - Switch can enable or disable the power feed from the DC in jack, allowing you to isolate the power source.</li>
<li><strong>PWM0/1 LEDs</strong> - Two LEDs are connected directly to the PWM pins on C.H.I.P. Pro to make it easy to test PWM in software by dimming these LEDs.</li>
<li><strong>C.H.I.P. Pro Power Button</strong> - If there is power from DC, USB, or battery, you can hold this down for 1 second to turn C.H.I.P. Pro on, or hold for 5 seconds to turn it off.</li>
<li><strong>MIC1/2</strong> - Two on-board microphones are spaced 40mm apart, ideal for testing voice control applications and beam-forming algorithms. (With sound travelling at ~340 m/s, the delay between the two microphones is 5.64 samples @ 48K sampling rate, or 117 microseconds)</li>
<li><strong>GPIO D0-7 LED</strong> - These are connected directly to GPIO D0 to D7 on C.H.I.P. Pro for easy software examples using GPIO control.</li>
<li><strong>UART1 TX/RX LEDs</strong> - These LEDs indicate when data is passing on the UART1 TX and RX pins.</li>
<li><strong>FEL Button</strong> - This button needs to be held down before C.H.I.P. Pro is powered up to put it in FEL mode for flashing new firmware.</li>
</ul>

<h2 id="pin-headers">Pin Headers</h2>

<p><img src="/images/ThruHoles.jpg" alt="Pin Headers"></p>

<p>There are several areas where pin headers can be soldered into through-holes for easy access and control of the pins on C.H.I.P. Pro.</p>

<ul>
<li><strong>PWM0/1 Through-Hole Breakout</strong> - Add pin headers to connect servos and LEDs with pulse width modulation.</li>
<li><strong>Battery Switch</strong> - Add a switch so you can easily disable or enable power from a battery. You will need to <a href="#back-traces">cut a trace</a> to make this switch work. </li>
<li><strong>C.H.I.P. Pro</strong> - The through-holes surrounding the C.H.I.P. Pro can be filled with pin headers to give access to the pin you need.</li>
</ul>

<h2 id="cuttable-traces">Cuttable Traces</h2>

<p>The C.H.I.P. Pro Dev Kit is designed to be flexible for your design and provide valuable built-in hardware. There are several cuttable circuit paths that will disconnect onboard components and reroute power and data to where you need. You can find all of the cuttable paths jumpers outlined in the images below.</p>

<p>Default circuit paths are indicated with a silkscreened bar under the connected pads. </p>

<p>Most of these traces are on the back of the board with one very important exception. The USB0 jumpers on the front are connected to the micro USB0 port on the Dev Kit. This renders the micro USB port on the C.H.I.P. Pro itself unusable. If you would like to use the micro USB port on C.H.I.P. Pro these must be cut. </p>

<p><img src="/images/cutJumpers.jpg" alt="Front Callouts"></p>

<h3 id="front-traces">Front Traces</h3>

<ul>
<li><strong>USB0 Disconnect</strong> - There are two traces that are important for USB communication and one (1) trace that will disconnect USB power from the main micro USB connnector to C.H.I.P. Pro. To disconnect the dev kit’s main micro USB connector, cut between the pads for the traces marked “+” and “-”. These are for the “D+” and “D-” USB data lines. This will allow you to use the micro USB connector on the C.H.I.P. Pro.</li>
</ul>

<h3 id="back-traces">Back Traces</h3>

<ul>
<li><strong>UART Disconnect</strong> - Cut these traces to disable the UART functionality from the dev kit’s USB micro connector. This disables the FE1.1S USB hub controller IC.</li>
<li><strong>MIC1/MIC2 Power Select</strong> - Cut-and-solder these pads to change the power source for the onboard mics. Cut between the pads marked with the line, then solder bridge the other two pads to select 3.3 volt power instead of the default VMIC power for MIC1 or MIC2. By default the dev kit is wired to VMIC which provides power only while recording. </li>
<li><strong>MIC1/MIC2 Ground Select</strong> - Cut-and-solder these pads to change the ground for the onboard mics. Cut between the pads with the line, then solder between the other two pads to select GND instead of the default AGND power for MIC1 or MIC2.</li>
<li><strong>GPIO LED Disconnect</strong> - If you don’t want the on-board GPIO LEDs to illuminate, cut this trace.</li>
<li><strong>MIC2 Disconnect</strong> - Cut this trace to disconnect the onboard microphone and enable the MIC2 pin on C.H.I.P. Pro.</li>
<li><strong>PWM LED Disconnect</strong> - If you don’t want the LEDs to illuminate when using PWM from the C.H.I.P. Pro pins, cut this trace. </li>
<li><strong>MIC1 Disconnect</strong> - Cut this trace to disconnect the onboard microphone and enable the MIC1 pin on C.H.I.P. Pro.</li>
<li><strong>Enable Sleeve for MIC1 IN</strong> - Solder over these pads to use the sleeve (“S” of the TRRS) of the 1/8" audio jack.</li>
<li><strong>HP (headphone) Ground Select</strong> - Cut-and-solder these pads to change the grounding for the headphone jack. Cut between the pads with the line, then solder between the other two pads to use HPCOM instead of GND.</li>
<li><strong>Battery Disconnect</strong> - If you want to add a switch for a battery, you’ll need to cut this trace, then solder a switch into the through-holes provided.</li>
<li><strong>USB1 Host Power Select</strong> - Cut-and-solder to power the USB A (host) jack from the barrel jack (wall power) instead of the default power from the USB Micro. </li>
</ul>

<h2 id="how-to-cut">How to Cut</h2>

<p>Here’s what you need to know about modifying and repairing the traces on the Dev Kit to experiment and test different configurations.</p>

<h3 id="cut">Cut</h3>

<p>To get the job done you need to grab an X-acto knife or another small, sharp blade. The goal is to cut the trace connecting the two solder pads while NOT cutting anything else. The area to cut is very small so if you happen to own a pair of magnifying eye glasses now is the time to use them! To help stay in one place and not accidentally run the blade over another trace think of the cutting action as more of a digging one. </p>

<p><img src="/images/traces_cut.jpg" alt="Cut Jumper"></p>

<p>When you feel like you may have successfully cut through test the connection with your multimeter to confirm the disconnect.</p>

<p><img src="/images/traces_test.jpg" alt="Test Jumper"></p>

<h3 id="cut-and-solder">Cut-and-Solder</h3>

<p>Some of these require both a trace cut and a solder bridge. For example, the MIC1 power has three pads. Cut between two of the pads, and bridge two with solder.</p>

<p><img src="/images/traces_solderCutHand.jpg" alt="Solder and Cut Jumper"></p>

<h3 id="revert-and-repair">Revert and Repair</h3>

<p>Once you cut a trace it can be reverted to the original behavior. To replace the jumper solder a small piece of wire across all the contacts you wish to reconnect, or, if you are nimble, bridge the contacts with a solder blob.</p>

<p>If you need some reminding, circuit paths that came as default are indicated with a silkscreened bar under the originally connected pads.</p>

<p><img src="/images/traces_solderBridge.jpg" alt="Solder Bridge"></p>
